---
import BaseLayout from '../../layouts/BaseLayout.astro';
import questions from '../../data/saat-questions.json';

const breadcrumbItems = [
  { name: "Home", url: "/en/" },
  { name: "SAAT‚Ñ¢ Test", url: "/en/test-saat" }
];

const QUESTIONS_PER_PAGE = 10;
const totalPages = Math.ceil(questions.length / QUESTIONS_PER_PAGE);
---

<BaseLayout 
  title="SAAT‚Ñ¢ Test ‚Äì Skills Assessment | ABSIG Consulting"
  description="Discover the SAAT‚Ñ¢ test (Sigler's Ability Analysis), our professional assessment tool to identify talents and optimize your recruitments."
  currentPage="test-saat"
  currentLang="en"
  breadcrumbItems={breadcrumbItems}
>

  <!-- ===== HERO SECTION ‚Äì PREMIUM ===== -->
  <section class="saat-hero">
    <!-- Animated particles -->
    <div class="hero-particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>
    <div class="saat-hero-content">
      <div class="saat-hero-badge" data-aos="fade-down">üß† EXCLUSIVE ASSESSMENT TOOL</div>
      <h1 data-aos="fade-up"><span class="gold-text">SAAT‚Ñ¢</span> Test</h1>
      <h2 class="saat-hero-fullname" data-aos="fade-up" data-aos-delay="50">Sigler's Ability Analysis</h2>
      <p data-aos="fade-up" data-aos-delay="100">
        A professional orientation test with <strong>87 questions</strong> that analyzes 
        personality, communication, and action capacity of each candidate. 
        A powerful tool for <strong>informed recruitments</strong>.
      </p>
      <!-- Mini stats in hero -->
      <div class="hero-mini-stats" data-aos="fade-up" data-aos-delay="200">
        <div class="mini-stat">
          <span class="mini-stat-number">87</span>
          <span class="mini-stat-label">Questions</span>
        </div>
        <div class="mini-stat-divider"></div>
        <div class="mini-stat">
          <span class="mini-stat-number">13</span>
          <span class="mini-stat-label">Dimensions</span>
        </div>
        <div class="mini-stat-divider"></div>
        <div class="mini-stat">
          <span class="mini-stat-number">15</span>
          <span class="mini-stat-label">Minutes</span>
        </div>
      </div>
      <div class="hero-actions" data-aos="fade-up" data-aos-delay="300">
        <a href="#questionnaire" class="hero-cta-gold">Take the test ‚Üí</a>
        <a href="#how-it-works" class="hero-cta-ghost">How does it work?</a>
      </div>
    </div>
  </section>

  <!-- ===== INFO CARDS ===== -->
  <section class="saat-info-section">
    <div class="container">
      <h2 class="text-center" data-aos="fade-up">Why use the <span style="color: #0d9488;">SAAT‚Ñ¢</span>?</h2>
      <p class="text-center" style="color: #64748b; max-width: 650px; margin: 1rem auto 0;" data-aos="fade-up" data-aos-delay="50">
        Used by hundreds of companies, the SAAT‚Ñ¢ test is the reference for evaluating the real potential of your candidates.
      </p>
      <div class="saat-info-grid">
        
        <div class="saat-info-card" data-aos="fade-up" data-aos-delay="100">
          <div class="saat-info-icon">üéØ</div>
          <h3>Precise Recruitment</h3>
          <p>Identify strengths and weaknesses through multi-criteria analysis covering <strong>13 dimensions</strong> of personality.</p>
        </div>

        <div class="saat-info-card" data-aos="fade-up" data-aos-delay="200">
          <div class="saat-info-icon">‚ö°</div>
          <h3>Quick & Simple</h3>
          <p>87 ternary choice questions (Yes / ¬± / No). The test is completed in <strong>15-20 minutes</strong> without pressure.</p>
        </div>

        <div class="saat-info-card" data-aos="fade-up" data-aos-delay="300">
          <div class="saat-info-icon">üõ°Ô∏è</div>
          <h3>Non-Eliminatory</h3>
          <p>An orientation tool, not an exam. It <strong>reveals potential</strong> and guides decisions without judgment.</p>
        </div>

        <div class="saat-info-card" data-aos="fade-up" data-aos-delay="400">
          <div class="saat-info-icon">üîí</div>
          <h3>100% Confidential</h3>
          <p>Compliant with Data Protection regulations (<strong>GDPR</strong>). Data processed in strict confidentiality.</p>
        </div>

      </div>
    </div>
  </section>

  <!-- ===== HOW IT WORKS ===== -->
  <section class="saat-how-it-works" id="how-it-works">
    <div class="container">
      <h2 class="text-center" data-aos="fade-up">How does the SAAT‚Ñ¢ work?</h2>
      <p class="text-center" style="color: #64748b; max-width: 600px; margin: 1rem auto 0;" data-aos="fade-up" data-aos-delay="50">
        A simple 4-step process for a comprehensive assessment
      </p>
      <div class="how-steps">
        
        <div class="how-step" data-aos="fade-up" data-aos-delay="100">
          <div class="how-step-number">1</div>
          <div class="how-step-icon">üìã</div>
          <h3>Fill in Profile</h3>
          <p>The candidate provides their contact details and the target position</p>
        </div>

        <div class="how-step-connector" data-aos="fade-up" data-aos-delay="150">
          <div class="connector-line"></div>
          <div class="connector-arrow">‚Üí</div>
        </div>

        <div class="how-step" data-aos="fade-up" data-aos-delay="200">
          <div class="how-step-number">2</div>
          <div class="how-step-icon">‚úçÔ∏è</div>
          <h3>Answer 87 Questions</h3>
          <p>Simple choices: Yes, More or less, or No. No wrong answers.</p>
        </div>

        <div class="how-step-connector" data-aos="fade-up" data-aos-delay="250">
          <div class="connector-line"></div>
          <div class="connector-arrow">‚Üí</div>
        </div>

        <div class="how-step" data-aos="fade-up" data-aos-delay="300">
          <div class="how-step-number">3</div>
          <div class="how-step-icon">üìä</div>
          <h3>Expert Analysis</h3>
          <p>Our analysts process the results across the 13 test dimensions</p>
        </div>

        <div class="how-step-connector" data-aos="fade-up" data-aos-delay="350">
          <div class="connector-line"></div>
          <div class="connector-arrow">‚Üí</div>
        </div>

        <div class="how-step" data-aos="fade-up" data-aos-delay="400">
          <div class="how-step-number">4</div>
          <div class="how-step-icon">‚úÖ</div>
          <h3>Detailed Report</h3>
          <p>You receive a complete profile with recommendations for your recruitment</p>
        </div>

      </div>
    </div>
  </section>

  <!-- ===== 3 KEY DIMENSIONS ===== -->
  <section class="saat-dimensions">
    <div class="container">
      <h2 class="text-center" data-aos="fade-up">The 3 Key Dimensions</h2>
      <p class="text-center" style="color: #64748b; max-width: 600px; margin: 1rem auto 0;" data-aos="fade-up" data-aos-delay="50">
        The SAAT‚Ñ¢ evaluates each candidate on three fundamental axes, complemented by 10 secondary parameters.
      </p>
      <div class="dimensions-grid">
        
        <div class="dimension-card personality" data-aos="fade-up" data-aos-delay="100">
          <div class="dimension-letter">P</div>
          <h3>Personality</h3>
          <div class="dimension-range">Scale -200 to +200</div>
          <p>Degree of extroversion, self-assurance, and state of being. Reveals the candidate's natural temperament.</p>
          <div class="dimension-scale">
            <span class="scale-label left">Introverted</span>
            <div class="scale-bar">
              <div class="scale-indicator" style="left: 65%;"></div>
              <div class="scale-center"></div>
            </div>
            <span class="scale-label right">Extroverted</span>
          </div>
        </div>

        <div class="dimension-card communication" data-aos="fade-up" data-aos-delay="200">
          <div class="dimension-letter">C</div>
          <h3>Communication</h3>
          <div class="dimension-range">Scale -200 to +200</div>
          <p>Ability to send, receive, and exchange communications. Essential for teamwork.</p>
          <div class="dimension-scale">
            <span class="scale-label left">Inhibited</span>
            <div class="scale-bar">
              <div class="scale-indicator" style="left: 72%;"></div>
              <div class="scale-center"></div>
            </div>
            <span class="scale-label right">Expressive</span>
          </div>
        </div>

        <div class="dimension-card action" data-aos="fade-up" data-aos-delay="300">
          <div class="dimension-letter">A</div>
          <h3>Action</h3>
          <div class="dimension-range">Scale -200 to +200</div>
          <p>Effectiveness in completing tasks. Transforming intentions into concrete results.</p>
          <div class="dimension-scale">
            <span class="scale-label left">Overwhelmed</span>
            <div class="scale-bar">
              <div class="scale-indicator" style="left: 58%;"></div>
              <div class="scale-center"></div>
            </div>
            <span class="scale-label right">Effective</span>
          </div>
        </div>

      </div>

      <!-- Secondary Parameters Preview -->
      <div class="secondary-params" data-aos="fade-up" data-aos-delay="400">
        <h3>+ 10 Secondary Parameters analyzed</h3>
        <div class="params-tags">
          <span class="param-tag">Sincerity</span>
          <span class="param-tag">Negative Personality</span>
          <span class="param-tag">Sales</span>
          <span class="param-tag">Control</span>
          <span class="param-tag">Responsibility</span>
          <span class="param-tag">Honesty</span>
          <span class="param-tag">Organization</span>
          <span class="param-tag">Relationships</span>
          <span class="param-tag">Negativity</span>
          <span class="param-tag">Decision</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== DETECTED PROFILES ===== -->
  <section class="saat-profiles">
    <div class="container">
      <h2 class="text-center" data-aos="fade-up">Profiles Detected by the SAAT‚Ñ¢</h2>
      <p class="text-center" style="color: rgba(255,255,255,0.8); max-width: 600px; margin: 1rem auto 0;" data-aos="fade-up" data-aos-delay="50">
        The test automatically identifies the dominant professional profile of each candidate
      </p>
      <div class="profiles-grid">
        
        <div class="profile-type-card" data-aos="fade-up" data-aos-delay="100">
          <div class="profile-type-icon">üëî</div>
          <h3>Manager / Executive</h3>
          <p>Strong personality, high communication, sense of responsibility and control</p>
          <div class="profile-traits">
            <span class="trait high">P ‚Üë</span>
            <span class="trait high">C ‚Üë</span>
            <span class="trait high">Co ‚Üë</span>
            <span class="trait high">R ‚Üë</span>
          </div>
        </div>

        <div class="profile-type-card" data-aos="fade-up" data-aos-delay="200">
          <div class="profile-type-icon">üíº</div>
          <h3>Sales / Commercial</h3>
          <p>Natural persuasion, ease in relationships, dynamism</p>
          <div class="profile-traits">
            <span class="trait high">V ‚Üë</span>
            <span class="trait high">C ‚Üë</span>
            <span class="trait high">RA ‚Üë</span>
          </div>
        </div>

        <div class="profile-type-card" data-aos="fade-up" data-aos-delay="300">
          <div class="profile-type-icon">üîß</div>
          <h3>Technical / Operator</h3>
          <p>Rigor, organization, action capacity, and work autonomy</p>
          <div class="profile-traits">
            <span class="trait high">A ‚Üë</span>
            <span class="trait high">O ‚Üë</span>
            <span class="trait high">R ‚Üë</span>
          </div>
        </div>

        <div class="profile-type-card" data-aos="fade-up" data-aos-delay="400">
          <div class="profile-type-icon">üè¢</div>
          <h3>Director</h3>
          <p>Leadership, vision, high control and maximum responsibility</p>
          <div class="profile-traits">
            <span class="trait high">P ‚Üë</span>
            <span class="trait high">Co ‚Üë‚Üë</span>
            <span class="trait high">R ‚Üë‚Üë</span>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- ===== QUESTIONNAIRE ===== -->
  <section class="saat-questionnaire-section" id="questionnaire">
    <div class="container">
      <div class="questionnaire-container">
        
        <h2 class="text-center" style="margin-bottom: 0.5rem;" data-aos="fade-up">
          Take the <span style="color: #0d9488;">SAAT‚Ñ¢</span> Test
        </h2>
        <p class="text-center" style="color: #64748b; margin-bottom: 1rem;" data-aos="fade-up" data-aos-delay="50">
          Answer honestly to all 87 questions. There are no right or wrong answers.
        </p>
        <p class="text-center" style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 2.5rem; font-style: italic;" data-aos="fade-up" data-aos-delay="80">
          ‚ÑπÔ∏è The questions are in French as this is a standardized assessment tool. Answer options: Yes / More or less / No.
        </p>

        <!-- PROFILE FORM -->
        <div class="profile-form" id="profileForm" data-aos="fade-up">
          <h3>üë§ Candidate Information</h3>
          <div class="profile-fields">
            <div class="field-group">
              <label for="companyName">Company Name</label>
              <input type="text" id="companyName" name="companyName" placeholder="E.g.: ABSIG Consulting" required>
            </div>
            <div class="field-group">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" name="fullName" placeholder="E.g.: John Smith" required>
            </div>
            <div class="field-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" name="phone" placeholder="E.g.: +33 6 12 34 56 78">
            </div>
            <div class="field-group">
              <label for="function">Position / Role</label>
              <input type="text" id="function" name="function" placeholder="E.g.: Head Chef">
            </div>
            <div class="field-group full-width">
              <label for="completedBy">Test completed by</label>
              <input type="text" id="completedBy" name="completedBy" placeholder="Name of the person completing the test">
            </div>
          </div>
          <div class="profile-start-hint">
            <span>üí°</span> Fill in at least the name to start the questionnaire
          </div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="progress-container" id="progressContainer" style="display: none;">
          <div class="progress-header">
            <span class="progress-text">üìä Progress</span>
            <span class="progress-count" id="progressCount">0 / 87 (0%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
          <div class="progress-meta">
            <span class="progress-timer" id="progressTimer">‚è±Ô∏è 0:00</span>
            <span class="progress-estimate" id="progressEstimate">~15 min remaining</span>
          </div>
        </div>

        <!-- QUESTIONS PAGES -->
        <div id="questionsWrapper" style="display: none;">
          {Array.from({ length: totalPages }, (_, pageIndex) => {
            const startIdx = pageIndex * QUESTIONS_PER_PAGE;
            const pageQuestions = questions.slice(startIdx, startIdx + QUESTIONS_PER_PAGE);
            
            return (
              <div class={`questions-page ${pageIndex === 0 ? 'active' : ''}`} data-page={pageIndex}>
                {pageQuestions.map((q) => (
                  <div class="question-card" data-question-id={q.id}>
                    <div class="question-header">
                      <div class="question-number">{q.id}</div>
                      <div class="question-text">{q.text}</div>
                    </div>
                    <div class="answer-options">
                      <div class="answer-option">
                        <input type="radio" name={`q${q.id}`} id={`q${q.id}_oui`} value="OUI">
                        <label for={`q${q.id}_oui`}>‚úì Yes</label>
                      </div>
                      <div class="answer-option">
                        <input type="radio" name={`q${q.id}`} id={`q${q.id}_pm`} value="PLUS_OU_MOINS">
                        <label for={`q${q.id}_pm`}>¬± More or less</label>
                      </div>
                      <div class="answer-option">
                        <input type="radio" name={`q${q.id}`} id={`q${q.id}_non`} value="NON">
                        <label for={`q${q.id}_non`}>‚úó No</label>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            );
          })}

          <!-- PAGE NAVIGATION -->
          <div class="page-navigation">
            <button class="nav-btn" id="prevBtn" disabled>
              ‚Üê Previous
            </button>
            <span class="page-indicator" id="pageIndicator">Page 1 / {totalPages}</span>
            <button class="nav-btn primary" id="nextBtn">
              Next ‚Üí
            </button>
          </div>

          <!-- PAGE DOTS -->
          <div class="page-dots" id="pageDots">
            {Array.from({ length: totalPages }, (_, i) => (
              <button class={`page-dot ${i === 0 ? 'active' : ''}`} data-dot={i} aria-label={`Page ${i + 1}`}></button>
            ))}
          </div>
        </div>

        <!-- SUBMIT SECTION -->
        <div class="submit-section" id="submitSection">
          <h3>üéâ Almost done!</h3>
          <p>Review your answers then submit the test for analysis.</p>
          <button class="submit-btn" id="submitBtn" disabled>
            <span class="btn-icon">üì≤</span>
            Send via WhatsApp
          </button>
          <div class="validation-warning" id="validationWarning">
            ‚ö†Ô∏è <span id="warningText">Please answer all questions before submitting.</span>
          </div>
        </div>

        <!-- SUCCESS MESSAGE -->
        <div class="success-message" id="successMessage">
          <div class="success-icon">‚úÖ</div>
          <h3>Test submitted successfully!</h3>
          <p>Thank you for your participation. Our team will analyze the results and contact you shortly.</p>
          <a href="/en/" class="saat-cta-btn" style="margin-top: 2rem; display: inline-flex;">Back to Home</a>
        </div>

        <!-- CONFETTI CONTAINER -->
        <div class="confetti-container" id="confettiContainer"></div>

      </div>
    </div>
  </section>

  <!-- ===== CTA ===== -->
  <section class="saat-cta">
    <div class="container">
      <h2 data-aos="fade-up">Need help with your assessments?</h2>
      <p data-aos="fade-up" data-aos-delay="100">
        Our team is available to guide you through result interpretation and the recruitment process.
      </p>
      <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;" data-aos="fade-up" data-aos-delay="200">
        <a href="/en/contact" class="saat-cta-btn">üìû Contact Us</a>
        <a href="tel:0682267342" class="saat-cta-btn" style="background: rgba(255,255,255,0.15); color: white; border: 2px solid rgba(255,255,255,0.3);">Call Now</a>
      </div>
    </div>
  </section>

  <!-- FLOATING CTA BUTTON -->
  <a href="#questionnaire" class="floating-test-btn" id="floatingTestBtn" aria-label="Take the SAAT test">
    <span class="floating-btn-icon">üß†</span>
    <span class="floating-btn-text">Take the test</span>
  </a>

</BaseLayout>

<style>
  @import '../../styles/saat.css';
</style>

<script is:inline>
document.addEventListener('DOMContentLoaded', function() {
  // ===== CONFIG =====
  const TOTAL_QUESTIONS = 87;
  const QUESTIONS_PER_PAGE = 10;
  const TOTAL_PAGES = Math.ceil(TOTAL_QUESTIONS / QUESTIONS_PER_PAGE);
  const WHATSAPP_NUMBER = '33682267342';
  const STORAGE_KEY = 'saat_test_data_en';
  
  let currentPage = 0;
  let answers = {};
  let profileStarted = false;
  let testSubmitted = false;
  let timerSeconds = 0;
  let timerInterval = null;

  // ===== DOM ELEMENTS =====
  const profileForm = document.getElementById('profileForm');
  const progressContainer = document.getElementById('progressContainer');
  const questionsWrapper = document.getElementById('questionsWrapper');
  const progressFill = document.getElementById('progressFill');
  const progressCount = document.getElementById('progressCount');
  const progressTimer = document.getElementById('progressTimer');
  const progressEstimate = document.getElementById('progressEstimate');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const pageIndicator = document.getElementById('pageIndicator');
  const submitSection = document.getElementById('submitSection');
  const submitBtn = document.getElementById('submitBtn');
  const validationWarning = document.getElementById('validationWarning');
  const warningText = document.getElementById('warningText');
  const successMessage = document.getElementById('successMessage');
  const pages = document.querySelectorAll('.questions-page');
  const dots = document.querySelectorAll('.page-dot');
  const floatingBtn = document.getElementById('floatingTestBtn');
  const confettiContainer = document.getElementById('confettiContainer');

  // ===== LOCALSTORAGE: SAVE & RESTORE =====
  function saveToStorage() {
    const data = {
      answers: answers,
      currentPage: currentPage,
      timerSeconds: timerSeconds,
      profileStarted: profileStarted,
      profile: {
        companyName: document.getElementById('companyName').value,
        fullName: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        function: document.getElementById('function').value,
        completedBy: document.getElementById('completedBy').value
      }
    };
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch(e) {}
  }

  function restoreFromStorage() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return false;
      const data = JSON.parse(raw);
      if (!data || !data.answers || Object.keys(data.answers).length === 0) return false;
      
      answers = data.answers;
      Object.keys(answers).forEach(qId => {
        const radio = document.querySelector('input[name="q' + qId + '"][value="' + answers[qId] + '"]');
        if (radio) {
          radio.checked = true;
          const card = radio.closest('.question-card');
          if (card) card.classList.add('answered');
        }
      });

      if (data.profile) {
        if (data.profile.companyName) document.getElementById('companyName').value = data.profile.companyName;
        if (data.profile.fullName) document.getElementById('fullName').value = data.profile.fullName;
        if (data.profile.phone) document.getElementById('phone').value = data.profile.phone;
        if (data.profile.function) document.getElementById('function').value = data.profile.function;
        if (data.profile.completedBy) document.getElementById('completedBy').value = data.profile.completedBy;
      }

      timerSeconds = data.timerSeconds || 0;
      profileStarted = true;
      progressContainer.style.display = 'block';
      questionsWrapper.style.display = 'block';
      
      if (data.currentPage) goToPage(data.currentPage);
      updateProgress();
      startTimer();
      
      return true;
    } catch(e) { return false; }
  }

  // ===== TIMER =====
  function startTimer() {
    if (timerInterval) return;
    timerInterval = setInterval(() => {
      timerSeconds++;
      const mins = Math.floor(timerSeconds / 60);
      const secs = timerSeconds % 60;
      progressTimer.textContent = '‚è±Ô∏è ' + mins + ':' + (secs < 10 ? '0' : '') + secs;
      
      const answeredCount = Object.keys(answers).length;
      if (answeredCount > 5) {
        const avgTimePerQ = timerSeconds / answeredCount;
        const remaining = Math.max(0, TOTAL_QUESTIONS - answeredCount);
        const estMinutes = Math.ceil((remaining * avgTimePerQ) / 60);
        progressEstimate.textContent = estMinutes > 0 ? '~' + estMinutes + ' min remaining' : '‚úÖ Almost done!';
      }
    }, 1000);
  }

  // ===== BEFOREUNLOAD WARNING =====
  window.addEventListener('beforeunload', function(e) {
    if (profileStarted && !testSubmitted && Object.keys(answers).length > 0) {
      saveToStorage();
      e.preventDefault();
      e.returnValue = 'Warning: your answers will be saved, but are you sure you want to leave?';
    }
  });

  // ===== CONFETTI =====
  function launchConfetti() {
    const colors = ['#d4af37', '#0d9488', '#6366f1', '#22c55e', '#f59e0b', '#ef4444', '#8b5cf6'];
    for (let i = 0; i < 80; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.setProperty('--x', (Math.random() * 100) + 'vw');
      confetti.style.setProperty('--rot', (Math.random() * 360) + 'deg');
      confetti.style.setProperty('--delay', (Math.random() * 0.5) + 's');
      confetti.style.setProperty('--duration', (2 + Math.random() * 2) + 's');
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.width = (6 + Math.random() * 8) + 'px';
      confetti.style.height = (6 + Math.random() * 8) + 'px';
      confettiContainer.appendChild(confetti);
    }
    confettiContainer.classList.add('active');
    setTimeout(() => {
      confettiContainer.classList.remove('active');
      confettiContainer.innerHTML = '';
    }, 4000);
  }

  // ===== FIND FIRST UNANSWERED =====
  function scrollToFirstUnanswered() {
    for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
      if (!answers[i]) {
        const targetPage = Math.floor((i - 1) / QUESTIONS_PER_PAGE);
        goToPage(targetPage);
        setTimeout(() => {
          const card = document.querySelector('.question-card[data-question-id="' + i + '"]');
          if (card) {
            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            card.classList.add('highlight-unanswered');
            setTimeout(() => card.classList.remove('highlight-unanswered'), 3000);
          }
        }, 400);
        return;
      }
    }
  }

  // ===== FLOATING BUTTON =====
  let floatingVisible = false;
  window.addEventListener('scroll', function() {
    const scrollY = window.scrollY;
    if (scrollY > 500 && !floatingVisible) {
      floatingBtn.classList.add('visible');
      floatingVisible = true;
    } else if (scrollY <= 500 && floatingVisible) {
      floatingBtn.classList.remove('visible');
      floatingVisible = false;
    }
  });

  // ===== PROFILE CHECK =====
  const profileInputs = profileForm.querySelectorAll('input');
  profileInputs.forEach(input => {
    input.addEventListener('input', function() {
      if (!profileStarted) {
        profileStarted = true;
        progressContainer.style.display = 'block';
        questionsWrapper.style.display = 'block';
        startTimer();
        setTimeout(() => {
          questionsWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 300);
      }
      saveToStorage();
    });
  });

  // ===== RADIO CHANGE =====
  document.querySelectorAll('.answer-options input[type="radio"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const qId = this.name.replace('q', '');
      answers[qId] = this.value;
      const card = this.closest('.question-card');
      card.classList.add('answered');
      updateProgress();
      saveToStorage();
    });
  });

  function updateProgress() {
    const answeredCount = Object.keys(answers).length;
    const percent = Math.round((answeredCount / TOTAL_QUESTIONS) * 100);
    
    progressFill.style.width = percent + '%';
    progressCount.textContent = answeredCount + ' / ' + TOTAL_QUESTIONS + ' (' + percent + '%)';

    if (answeredCount === TOTAL_QUESTIONS) {
      submitBtn.disabled = false;
      validationWarning.style.display = 'none';
      progressEstimate.textContent = '‚úÖ Complete!';
    } else {
      submitBtn.disabled = true;
      warningText.textContent = (TOTAL_QUESTIONS - answeredCount) + ' question(s) remaining.';
      validationWarning.style.display = 'inline-flex';
    }
  }

  // ===== PAGE NAVIGATION =====
  function goToPage(pageIndex) {
    if (pageIndex < 0 || pageIndex >= TOTAL_PAGES) return;

    const direction = pageIndex > currentPage ? 'slide-left' : 'slide-right';
    
    pages.forEach(p => {
      p.classList.remove('active', 'slide-left', 'slide-right');
    });
    dots.forEach(d => d.classList.remove('active'));

    currentPage = pageIndex;
    pages[currentPage].classList.add('active', direction);
    dots[currentPage].classList.add('active');

    dots.forEach((d, i) => {
      const pageStart = i * QUESTIONS_PER_PAGE + 1;
      const pageEnd = Math.min((i + 1) * QUESTIONS_PER_PAGE, TOTAL_QUESTIONS);
      let allAnswered = true;
      for (let q = pageStart; q <= pageEnd; q++) {
        if (!answers[q]) { allAnswered = false; break; }
      }
      if (allAnswered) d.classList.add('completed');
    });

    prevBtn.disabled = currentPage === 0;
    nextBtn.textContent = currentPage === TOTAL_PAGES - 1 ? 'Finish ‚Üí' : 'Next ‚Üí';
    pageIndicator.textContent = 'Page ' + (currentPage + 1) + ' / ' + TOTAL_PAGES;

    if (currentPage === TOTAL_PAGES - 1) submitSection.classList.add('visible');

    progressContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    saveToStorage();
  }

  prevBtn.addEventListener('click', () => goToPage(currentPage - 1));
  
  nextBtn.addEventListener('click', () => {
    if (currentPage < TOTAL_PAGES - 1) goToPage(currentPage + 1);
    else submitSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
  });

  dots.forEach(dot => {
    dot.addEventListener('click', () => goToPage(parseInt(dot.dataset.dot)));
  });

  // ===== KEYBOARD NAVIGATION =====
  document.addEventListener('keydown', function(e) {
    if (!questionsWrapper.style.display || questionsWrapper.style.display === 'none') return;
    if (e.key === 'ArrowRight' && currentPage < TOTAL_PAGES - 1) goToPage(currentPage + 1);
    else if (e.key === 'ArrowLeft' && currentPage > 0) goToPage(currentPage - 1);
  });

  // ===== SUBMIT =====
  submitBtn.addEventListener('click', function() {
    const answeredCount = Object.keys(answers).length;
    
    if (answeredCount < TOTAL_QUESTIONS) {
      warningText.textContent = (TOTAL_QUESTIONS - answeredCount) + ' question(s) remaining.';
      validationWarning.style.display = 'inline-flex';
      scrollToFirstUnanswered();
      return;
    }

    testSubmitted = true;
    if (timerInterval) clearInterval(timerInterval);

    const profile = {
      companyName: document.getElementById('companyName').value || 'Not provided',
      fullName: document.getElementById('fullName').value || 'Not provided',
      phone: document.getElementById('phone').value || 'Not provided',
      function: document.getElementById('function').value || 'Not provided',
      completedBy: document.getElementById('completedBy').value || 'Not provided',
      date: new Date().toLocaleDateString('en-GB')
    };

    const mins = Math.floor(timerSeconds / 60);
    const secs = timerSeconds % 60;
    const timeStr = mins + 'min ' + secs + 's';

    const pInfo = [profile.fullName || '', profile.companyName || '', profile.function || ''].join('|');
    let aCode = '';
    for(let i=1; i<=87; i++) {
        const val = answers[i];
        aCode += (val === 'OUI' ? '2' : (val === 'PLUS_OU_MOINS' ? '1' : '0'));
    }
    const compactData = btoa(encodeURIComponent(pInfo)).replace(/=/g, '') + '.' + aCode;
    const resultsLink = `https://absigg.netlify.app/resultats-test?v=2&d=${compactData}`;

    let msg = 'üß† *R√âSULTAT TEST SAAT‚Ñ¢*\n\n';
    msg += `*Candidat:* ${profile.fullName}\n`;
    msg += `*Poste:* ${profile.function}\n\n`;
    msg += `*Voir l'analyse compl√®te :*\n${resultsLink}\n\n`;
    msg += '*--- D√âTAILS ---*\n';
    msg += `*Soci√©t√©:* ${profile.companyName}\n`;
    msg += `*Par:* ${profile.completedBy}\n`;
    msg += `*Dur√©e:* ${timeStr}\n\n`;
    msg += '*--- ANSWERS (87 Q) ---*\n';

    let line = '';
    for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
      const a = answers[i];
      let code = '?';
      if (a === 'OUI') code = 'Y';
      else if (a === 'PLUS_OU_MOINS') code = '¬±';
      else if (a === 'NON') code = 'N';
      line += 'Q' + i + ':' + code + ' ';
      if (i % 10 === 0) { msg += line.trim() + '\n'; line = ''; }
    }
    if (line.trim()) msg += line.trim() + '\n';
    msg += '\n_Sent from absigg.netlify.app (EN)_';

    const waUrl = 'https://wa.me/' + WHATSAPP_NUMBER + '?text=' + encodeURIComponent(msg);
    window.open(waUrl, '_blank');

    try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}

    setTimeout(() => {
      questionsWrapper.style.display = 'none';
      profileForm.style.display = 'none';
      progressContainer.style.display = 'none';
      submitSection.style.display = 'none';
      successMessage.classList.add('visible');
      successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      launchConfetti();
    }, 500);
  });

  // ===== ANIMATED SCALE INDICATORS =====
  const scaleObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.querySelectorAll('.scale-indicator').forEach(ind => ind.classList.add('animate'));
        scaleObserver.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });
  document.querySelectorAll('.dimension-card').forEach(card => scaleObserver.observe(card));

  // ===== RESTORE SAVED SESSION =====
  const restored = restoreFromStorage();
  if (restored) {
    const notice = document.createElement('div');
    notice.className = 'restore-notice';
    notice.innerHTML = 'üíæ Previous session restored! <button onclick="this.parentElement.remove(); localStorage.removeItem(\'' + STORAGE_KEY + '\'); location.reload();">Start over</button>';
    document.querySelector('.questionnaire-container').prepend(notice);
  }

});
</script>
